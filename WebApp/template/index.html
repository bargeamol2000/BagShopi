<html>

<head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../static/styles/theme.css">
    <!-- crypto-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.2.0/aes.min.js"></script>
    <!-- Testing script end-->
    <script>
        var passin;
        var cpassin;
        var emailin;
        var cpass;
        var loginbtn;
        var signupbtn;

        function showSignUp() {

            cpass.style.display = "block";
            loginbtn.setAttribute("value", "Create Account");
            loginbtn.onclick = signup;
            signupbtn.setAttribute("value", "Login Now");
            signupbtn.setAttribute("onclick", "showLogin()");
        }

        function showLogin() {
            cpass.style.display = "none";
            loginbtn.setAttribute("value", "Login Now");
            loginbtn.onclick = login;
            signupbtn.setAttribute("value", "Create Account");
            signupbtn.setAttribute("onclick", "showSignUp()");
        }

        function closeLoginForm() {
            document.getElementById("logindiv").style.display = "none";
        }

        function showLoginForm() {
            passin = document.getElementById("passin");
            cpassin = document.getElementById("cpassin");
            emailin = document.getElementById("emailin");
            cpass = document.getElementById("confirmpass");
            loginbtn = document.getElementById("loginbtn");
            signupbtn = document.getElementById("signupbtn");
            document.getElementById("logindiv").style.display = "block";
        }

        function login() {
            emailin.value = emailin.value.toLowerCase();
            if (passin.value == "" || emailin.value == "") {
                alert("Please fill all fields");
            }
            else if (emailin.value.includes("@") && emailin.value.includes(".")) {
                database.ref('/users/' + SHA1(emailin.value)).once('value').then(function (snapshot) {
                    if (snapshot.exists()) {
                        var email = snapshot.val().email;
                        var password = snapshot.val().pw;
                        var fname = snapshot.val().fname;
                        var lname = snapshot.val().lname;
                        if (passin.value == password) {
                            sessionStorage.setItem("uid", SHA1(emailin.value));
                            alert("Welcome back " + fname + " " + lname);
                            location.reload();
                        }
                        else {
                            alert("Wrong email or password entered");
                        }
                    }
                    else {
                        alert("No accont registered with this email address please signup");
                    }
                });
            }
        }

        function signup() {
            emailin.value = emailin.value.toLowerCase();
            if (passin.value == "" || emailin.value == "" || cpassin.value == "") {
                alert("Please fill all fields");
            }
            else if (!(6 <= passin.value.length && passin.value.length <= 18)) {
                alert("Password length must be in range of 6-18");
            }
            else if (!(passin.value == cpassin.value)) {
                alert("Passwords are not matching");
            }
            else {
                //alert(SHA1(emailin.value));
                database.ref('/users/' + SHA1(emailin.value)).once('value').then(function (snapshot) {
                    if (snapshot.exists()) {
                        alert("This user already existed");
                    }
                    else {
                        $("#firstpart").animate({ left: "1000px" });
                        $("#secondpart").animate({ left: "+=1000" });
                    }
                });
            }
        }

        function submit() {
            var email = emailin.value;
            var password = passin.value;
            var fname = document.getElementById("fname").value;
            var lname = document.getElementById("lname").value;
            var mnum = document.getElementById("mnum").value;
            var address = document.getElementById("address").value;

            database.ref('/users/' + SHA1(emailin.value)).set({
                email: email,
                pw: password,
                fname: fname,
                lname: lname,
                mnum: mnum,
                address: address
            });

            sessionStorage.setItem("uid", SHA1(emailin.value));
            alert("Account Created Successfully. Now you can login");
            location.reload();

        }

        function logout(){
            sessionStorage.clear();
            location.reload();
        }

        /**
* Secure Hash Algorithm (SHA1)
* http://www.webtoolkit.info/
**/
        function SHA1(msg) {
            function rotate_left(n, s) {
                var t4 = (n << s) | (n >>> (32 - s));
                return t4;
            };
            function lsb_hex(val) {
                var str = '';
                var i;
                var vh;
                var vl;
                for (i = 0; i <= 6; i += 2) {
                    vh = (val >>> (i * 4 + 4)) & 0x0f;
                    vl = (val >>> (i * 4)) & 0x0f;
                    str += vh.toString(16) + vl.toString(16);
                }
                return str;
            };
            function cvt_hex(val) {
                var str = '';
                var i;
                var v;
                for (i = 7; i >= 0; i--) {
                    v = (val >>> (i * 4)) & 0x0f;
                    str += v.toString(16);
                }
                return str;
            };
            function Utf8Encode(string) {
                string = string.replace(/\r\n/g, '\n');
                var utftext = '';
                for (var n = 0; n < string.length; n++) {
                    var c = string.charCodeAt(n);
                    if (c < 128) {
                        utftext += String.fromCharCode(c);
                    }
                    else if ((c > 127) && (c < 2048)) {
                        utftext += String.fromCharCode((c >> 6) | 192);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                    else {
                        utftext += String.fromCharCode((c >> 12) | 224);
                        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                }
                return utftext;
            };
            var blockstart;
            var i, j;
            var W = new Array(80);
            var H0 = 0x67452301;
            var H1 = 0xEFCDAB89;
            var H2 = 0x98BADCFE;
            var H3 = 0x10325476;
            var H4 = 0xC3D2E1F0;
            var A, B, C, D, E;
            var temp;
            msg = Utf8Encode(msg);
            var msg_len = msg.length;
            var word_array = new Array();
            for (i = 0; i < msg_len - 3; i += 4) {
                j = msg.charCodeAt(i) << 24 | msg.charCodeAt(i + 1) << 16 |
                    msg.charCodeAt(i + 2) << 8 | msg.charCodeAt(i + 3);
                word_array.push(j);
            }
            switch (msg_len % 4) {
                case 0:
                    i = 0x080000000;
                    break;
                case 1:
                    i = msg.charCodeAt(msg_len - 1) << 24 | 0x0800000;
                    break;
                case 2:
                    i = msg.charCodeAt(msg_len - 2) << 24 | msg.charCodeAt(msg_len - 1) << 16 | 0x08000;
                    break;
                case 3:
                    i = msg.charCodeAt(msg_len - 3) << 24 | msg.charCodeAt(msg_len - 2) << 16 | msg.charCodeAt(msg_len - 1) << 8 | 0x80;
                    break;
            }
            word_array.push(i);
            while ((word_array.length % 16) != 14) word_array.push(0);
            word_array.push(msg_len >>> 29);
            word_array.push((msg_len << 3) & 0x0ffffffff);
            for (blockstart = 0; blockstart < word_array.length; blockstart += 16) {
                for (i = 0; i < 16; i++) W[i] = word_array[blockstart + i];
                for (i = 16; i <= 79; i++) W[i] = rotate_left(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1);
                A = H0;
                B = H1;
                C = H2;
                D = H3;
                E = H4;
                for (i = 0; i <= 19; i++) {
                    temp = (rotate_left(A, 5) + ((B & C) | (~B & D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;
                    E = D;
                    D = C;
                    C = rotate_left(B, 30);
                    B = A;
                    A = temp;
                }
                for (i = 20; i <= 39; i++) {
                    temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;
                    E = D;
                    D = C;
                    C = rotate_left(B, 30);
                    B = A;
                    A = temp;
                }
                for (i = 40; i <= 59; i++) {
                    temp = (rotate_left(A, 5) + ((B & C) | (B & D) | (C & D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;
                    E = D;
                    D = C;
                    C = rotate_left(B, 30);
                    B = A;
                    A = temp;
                }
                for (i = 60; i <= 79; i++) {
                    temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;
                    E = D;
                    D = C;
                    C = rotate_left(B, 30);
                    B = A;
                    A = temp;
                }
                H0 = (H0 + A) & 0x0ffffffff;
                H1 = (H1 + B) & 0x0ffffffff;
                H2 = (H2 + C) & 0x0ffffffff;
                H3 = (H3 + D) & 0x0ffffffff;
                H4 = (H4 + E) & 0x0ffffffff;
            }
            var temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);

            return temp.toLowerCase();
        }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>

<body>

    <!--Sliding images coursole-->

    <div class="container">
        <h2>Our Top Brands</h2>
        <div id="myCarousel" class="carousel slide" data-ride="carousel">
            <!-- Wrapper for slides -->
            <center>
                <div class="carousel-inner">
                    <div class="item active">
                        <img src="../static/imgs/topbrands/1.jpeg" alt="Los Angeles" style="width:80%;">
                    </div>

                    <div class="item">
                        <img src="../static/imgs/topbrands/2.jpeg" alt="Chicago" style="width:80%;">
                    </div>

                    <div class="item">
                        <img src="../static/imgs/topbrands/3.jpeg" alt="New york" style="width:80%;">
                    </div>

                    <div class="item">
                        <img src="../static/imgs/topbrands/4.jpeg" alt="Chicago" style="width:80%;">
                    </div>

                    <div class="item">
                        <img src="../static/imgs/topbrands/5.jpeg" alt="Chicago" style="width:80%;">
                    </div>

                    <div class="item">
                        <img src="../static/imgs/topbrands/6.jpeg" alt="Chicago" style="width:80%;">
                    </div>

                    <div class="item">
                        <img src="../static/imgs/topbrands/7.jpeg" alt="Chicago" style="width:80%;">
                    </div>
                </div>
            </center>


            <!-- Left and right controls -->
            <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#myCarousel" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>

    <!--Bags-->

    <div class="card-deck bags">
        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/burton.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Burton black mens its ahfds</h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>

        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/yellow.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Yellow sd sdkfhhe alkdf </h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>

        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/red.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Red sejh slge sie</h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>

        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/back.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Black sne lshe geres</h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>

        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/burton.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Burton sdrfe gh s erw</h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>

        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/yellow.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Yellow</h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>

        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/red.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Red</h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>

        <div class="card bag">
            <img class="card-img-top" src="../static/imgs/back.png" alt="Card image">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title">Black</h4>
                <p class="card-text">Rs.543</p>
                <a href="javascript:alert('Coming Soon');" class="btn btn-primary mt-auto">Buy Now</a>
            </div>
        </div>
    </div>

    <!--Top header-->

    <div id="header">
        <img id="logo" src="../static/icons/logo.png">
        <div id="topmenu">
            <div id="dropdown">
                <a class="menuoption dropbtn" id="accountoption" href="javascript:showLoginForm();"><b>Login/SignUp</b></a>
                <div class="dropdown-content">
                    <a href="account">Account</a>
                    <a href="myorders">My Orders</a>
                    <a href="javascript:logout();">Logout</a>
                  </div>
            </div>
            <a class="menuoption" href="/login.html"><b>Cart</b></a>
        </div>
        <div id="searchdiv">
            <input id="searchinput" name="query" placeholder="Search for bags">
            <img id="whitesearchicon" src="../static/icons/search.png" %}>
        </div>
    </div>

    <!--Login work here-->

    <div id="logindiv">
        <div class="card logincard">
            <div id="firstpart">
                <img class="logincross" src="../static/icons/cross.svg" onclick="closeLoginForm()">
                <img class="loginlogo" src="../static/icons/logo.png">

                <form class="loginform" id="loginform" align="center" onsubmit="return false">
                    <h4>Welcome Back :)</h4>
                    <p> To keep connected with us please login with your personal information by email and password</p>
                    <ul class="list-group">
                        <li class="list-group-item active">
                            <h6>Email</h6>
                            <input id="emailin" type="email" class="form-control" placeholder="joe@email.com">
                        </li>

                        <li class="list-group-item">
                            <h6>Password</h6>
                            <input id="passin" type="password" class="form-control" placeholder="Enter your password">
                        </li>

                        <li class="list-group-item" id="confirmpass">
                            <h6>Confirm Password</h6>
                            <input id="cpassin" type="password" class="form-control" placeholder="Enter your password">
                        </li>
                    </ul>

                    <br>

                    <div class="checkbox">
                        <h6 class="remb"> <input class="checkbox" type="checkbox"> Remember me</h6>
                    </div>

                    <a href="#" class="forgot">forgot password?</a>
                    <br><br>
                    <input type="submit" id="loginbtn" class="btn btn-primary" onclick="return login();"
                        value="Login Now">
                    <input type="submit" id="signupbtn" onclick="showSignUp()" class="btn" value="Create Account">
                </form>

                <img class="sideimg" src="../static/imgs/sideimg.jpg">
            </div>

            <div id="secondpart">
                <form onsubmit="return false">
                    <h3>Profile Details</h3>
                    <br>
                    <div class="form-group">
                        <label for="fname">First Name:</label>
                        <input type="text" class="form-control" id="fname">
                    </div>
                    <div class="form-group">
                        <label for="lname">Last Name:</label>
                        <input type="text" class="form-control" id="lname">
                    </div>
                    <div class="form-group">
                        <label for="mnum">Mobile No:</label>
                        <input type="number" class="form-control" id="mnum">
                    </div>
                    <div class="form-group">
                        <label for="address">Address:</label>
                        <textarea class="form-control" id="address"></textarea>
                    </div>
                    <br><br>
                    <a id="submitbtn" class="btn btn-primary" href="javascript:submit();">Submit</a>

                </form>
            </div>
        </div>
    </div>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.8.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
             https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.8.1/firebase-analytics.js"></script>

    <!-- All Firebase SDKs-->
    <!-- Add the entire Firebase JavaScript SDK -->
    <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase.js"></script>

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCITuIJ7DmCHOAS5n6d-0ahkUjJXRkEN1c",
            authDomain: "bagshopi.firebaseapp.com",
            databaseURL: "https://bagshopi.firebaseio.com",
            projectId: "bagshopi",
            storageBucket: "bagshopi.appspot.com",
            messagingSenderId: "356246138205",
            appId: "1:356246138205:web:30cb41e185af8a729d4cb4",
            measurementId: "G-3F90KW4J8F"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        // Get a reference to the database service
        var database = firebase.database();


        //check previous user login from session
        if (sessionStorage.getItem("uid") != null) {

            database.ref('/users/' + sessionStorage.getItem("uid")).once('value').then(function (snapshot) {
                var fname = snapshot.val().fname;
                var lname = snapshot.val().lname;

                var accountoption = document.getElementById("accountoption");
                accountoption.href = "javascript:alert('still in developement')";
                accountoption.innerHTML = "<b>" + fname + " " + lname + "</b>";

                document.getElementById("dropdown").className="dropdown";
            });
        }
    </script>
</body>

</html>